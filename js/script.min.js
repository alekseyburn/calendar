;(function() {
'use strict';

var calendar = document.querySelector('.calendar');
var inactiveDays = calendar.querySelectorAll('.table__day--off');
var saveButton = document.querySelector('.calendar__link'); // Объект для хранения информации о датах

var dateInfo = {
  April: {
    day1: {
      date: "1 Апреля",
      text: "some text here",
      link: "http://test.com"
    },
    day15: {
      date: "15 Апреля"
    },
    day30: {
      date: "30 Апреля"
    }
  },
  May: {
    day12: {
      date: "12 Мая"
    },
    day15: {
      date: "15 Мая"
    }
  },
  June: {
    day1: {
      date: "1 Июня"
    },
    day29: {
      date: "29 Июня"
    }
  }
}; //блокируем пустые td

function blockEmptyTd() {
  inactiveDays.forEach(function (item) {
    item.querySelector('a').tabIndex = -1;
  });
}

blockEmptyTd();

calendar.onclick = function (event) {
  // Возвращаем ближайшего предка, соответствующего селектору td
  var td = event.target.closest('td'); // Если event.target не содержится внутри td, то возвращаем null

  if (!td) return;

  if (td.classList.contains('table__day--active')) {
    renderDateInfo(td);
  } else if (!td.textContent) {
    return;
  } else {
    renderForm(td);
  }
}; // При нажатии на активную дату выводим под календарь информацию о дате


function renderDateInfo(date) {
  removeBlock(); // Берём заранее подготовленный шаблон из разметки и делаем его копию

  var template = document.querySelector('#date-info-template').content.querySelector('.date-info');
  var dateInfoElement = template.cloneNode(true); // Записываем в переменные месяц и день из ячейки таблицы, по которой произошел клик

  var month = "".concat(date.offsetParent.caption.dataset.month);
  var day = "day".concat(date.textContent); // Если на выбранной дате присутствует информация, то выводим её в конце таблицы

  if (dateInfo[month][day]) {
    dateInfoElement.querySelector('.date-info__title').textContent = dateInfo[month][day].date;
    dateInfoElement.querySelector('.date-info__text').textContent = dateInfo[month][day].text;

    if (dateInfo[month][day].link) {
      dateInfoElement.querySelector('.date-info__link').href = dateInfo[month][day].link;
    } else {
      dateInfoElement.querySelector('.date-info__link').remove();
    }

    calendar.appendChild(dateInfoElement);
  }
}

function renderForm(td) {
  removeBlock(); // Берём заранее подготовленный шаблон из разметки и делаем его копию

  var template = document.querySelector('#form-template').content.querySelector('.form');
  var formElement = template.cloneNode(true);
  var month = td.offsetParent.caption.textContent;
  var day = td.textContent; // Избавляемся от звёздочки, заменяем окончание у месяцев

  day = /\*/i.test(day) ? day.slice(0, day.length - 1) : day;
  month = month.replace(/[а-я]$/, function (match) {
    return match === 'т' ? 'та' : 'я';
  }); // Заполняяем день и месяц

  formElement.querySelector('.form__label').textContent = "".concat(day, " ").concat(month); // Добавляем форму на страницу

  calendar.appendChild(formElement);
  var form = document.querySelector("form");
  form.addEventListener("submit", fillForm);

  function fillForm(event) {
    event.preventDefault();
    var month = td.offsetParent.caption.dataset.month;
    var day = "day".concat(form.querySelector('.form__label').textContent.replace(/\D/g, ''));
    dateInfo[month][day] = {
      date: form.querySelector('.form__label').textContent,
      text: form.textarea.value
    };
    form.remove();
    renderCalendar();
    form.removeEventListener("submit", fillForm);
  }
}

function removeBlock() {
  // Если уже существует блок с формой на странице, то удаляем его
  if (calendar.querySelector('.form')) {
    calendar.querySelector('.form').remove();
  } // Если уже существует блок с информацией на странице, то удаляем его


  if (calendar.querySelector('.date-info')) {
    calendar.querySelector('.date-info').remove();
  }
}

function renderCalendar() {
  var _loop = function _loop(month) {
    var _loop2 = function _loop2(_day) {
      _day = _day.replace(/\D/g, '');
      var all = calendar.querySelectorAll('.table td');
      all.forEach(function (item) {
        var holiday = /\*/i.test(item.textContent) ? item.textContent.slice(0, item.textContent.length - 1) : item.textContent;

        if (holiday == _day && item.offsetParent.caption.dataset.month == month) {
          item.classList.add("table__day--active");
        }
      });
      day = _day;
    };

    for (var day in dateInfo[month]) {
      _loop2(day);
    }
  };

  for (var month in dateInfo) {
    _loop(month);
  }
}

renderCalendar();
saveButton.addEventListener("click", function (event) {
  event.preventDefault();
  renderDates();
  location.href = 'dates.html';
});

function renderDates() {
  var fragment = document.createDocumentFragment();
  var activeDates = calendar.querySelectorAll('.table__day--active');
  activeDates.forEach(function (item) {
    // Берём заранее подготовленный шаблон из разметки и делаем его копию
    var template = document.querySelector('#date-info-template').content.querySelector('.date-info');
    var dateInfoElement = template.cloneNode(true);
    dateInfoElement.classList.remove('calendar__info');
    dateInfoElement.classList.add('dates__item'); // Записываем в переменные месяц и день из ячейки таблицы, по которой произошел клик

    var month = "".concat(item.offsetParent.caption.dataset.month);
    var day = "day".concat(/\*/i.test(item.textContent) ? item.textContent.slice(0, item.textContent.length - 1) : item.textContent); // Создаём 1 экземпляр и заполняем его

    if (dateInfo[month][day]) {
      dateInfoElement.querySelector('.date-info__title').textContent = dateInfo[month][day].date;
      dateInfoElement.querySelector('.date-info__text').textContent = dateInfo[month][day].text;
      dateInfoElement.querySelector('.date-info__link').remove();
      fragment.appendChild(dateInfoElement);
    }
  });
  var div = document.createElement('div');
  div.appendChild(fragment);
  var selectedText = div.innerHTML;
  localStorage.fragment = JSON.stringify(selectedText);
}
}());

//# sourceMappingURL=script.min.js.map
