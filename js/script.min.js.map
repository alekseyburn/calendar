{"version":3,"sources":["script.js"],"names":["April","day1","date","text","link","day15","day30","May","day12","June","day29","inactiveDays","item","blockEmptyTd","calendar","renderDateInfo","renderForm","removeBlock","dateInfoElement","day","month","formElement","form","event","dateInfo","renderCalendar","all","saveButton","renderDates","location","activeDates","fragment","div","localStorage"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AAGA;AACEA;AACEC;AACEC;AACAC;AACAC;AAHI;AAKNC;AACEH;AADK;AAGPI;AACEJ;AADK;AATF;AAaPK;AACEC;AACEN;AADK;AAGPG;AACEH;AADK;AAJJ;AAQLO;AACER;AACEC;AADI;AAGNQ;AACER;AADK;AAJH;AAtBO;AA6Bf;AAIA;AACES;AACEC;AACD;AACF;AAFD;AAIAC;AAFA;AAIAC;AACE;AACA;AAFF;AAIE;AAFF;AAIE;AACEC;AACD;AACC;AACD;AACCC;AACD;AACF;AAFD;AACA;AAKA;AACEC;AAHF;AAME;AACA;AAJF;AAOE;AACA;AALF;AAQE;AACEC;AACAA;AANJ;AAOI;AACEA;AACD;AACCA;AACD;AALL;AAOIJ;AACD;AACF;AALD;AAOA;AACEG;AALF;AAQE;AACA;AAEA;AACA;AAPF;AAUEE;AACAC;AACE;AACD;AARH;AAWEC;AATF;AAYEP;AAEA;AACAQ;AAXF;AAaE;AACEC;AAEA;AACA;AAEAC;AACEtB;AACAC;AAFqB;AAKvBmB;AACAG;AACAH;AACD;AACF;AAdD;AAgBA;AACE;AACA;AACER;AACD;AAdH;AACA;AAgBE;AACEA;AACD;AACF;AAdD;AAgBA;AAA0B;AAAA;AAGpBK;AAEA;AACAO;AACE;AAfR;AAgBQ;AACEd;AACD;AACF;AAXmB;AAAA;AAD1B;AAGI;AAAiC;AAUhC;AAZqB;AAI1B;AAHE;AAA4B;AAY3B;AACF;AALD;AAOAa;AAGAE;AACEJ;AACAK;AACAC;AACD;AAPD;AASA;AACE;AACA;AAGAC;AACE;AACA;AACA;AACAZ;AACAA;AATJ;AAaI;AACA;AAXJ;AAcI;AACEA;AACAA;AACAA;AAEAa;AACD;AACF;AAED;AACAC;AACA;AACAC;AACD","file":"script.min.js","sourcesContent":["'use strict';\n\nlet calendar = document.querySelector('.calendar');\nlet inactiveDays = calendar.querySelectorAll('.table__day--off');\nlet saveButton = document.querySelector('.calendar__link');\n\n\n// Объект для хранения информации о датах\nlet dateInfo = {\n  April: {\n    day1: {\n      date: \"1 Апреля\",\n      text: \"some text here\",\n      link: \"http://test.com\"\n    },\n    day15: {\n      date: \"15 Апреля\",\n    },\n    day30: {\n      date: \"30 Апреля\",\n    },\n  },\n  May: {\n    day12: {\n      date: \"12 Мая\",\n    },\n    day15: {\n      date: \"15 Мая\",\n    },\n  },\n  June: {\n    day1: {\n      date: \"1 Июня\",\n    },\n    day29: {\n      date: \"29 Июня\",\n    },\n  },\n};\n\n//блокируем пустые td\nfunction blockEmptyTd() {\n  inactiveDays.forEach(item => {\n    item.querySelector('a').tabIndex = -1;\n  });\n}\n\nblockEmptyTd();\n\ncalendar.onclick = (event) => {\n  // Возвращаем ближайшего предка, соответствующего селектору td\n  let td = event.target.closest('td');\n  // Если event.target не содержится внутри td, то возвращаем null\n  if (!td) return;\n\n  if (td.classList.contains('table__day--active')) {\n    renderDateInfo(td);\n  } else if (!td.textContent) {\n    return;\n  } else {\n    renderForm(td);\n  }\n};\n\n\n// При нажатии на активную дату выводим под календарь информацию о дате\nfunction renderDateInfo(date) {\n  removeBlock();\n\n  // Берём заранее подготовленный шаблон из разметки и делаем его копию\n  let template = document.querySelector('#date-info-template').content.querySelector('.date-info');\n  let dateInfoElement = template.cloneNode(true);\n\n  // Записываем в переменные месяц и день из ячейки таблицы, по которой произошел клик\n  let month = `${date.offsetParent.caption.dataset.month}`;\n  let day = `day${date.textContent}`;\n\n  // Если на выбранной дате присутствует информация, то выводим её в конце таблицы\n  if (dateInfo[month][day]) {\n    dateInfoElement.querySelector('.date-info__title').textContent = dateInfo[month][day].date;\n    dateInfoElement.querySelector('.date-info__text').textContent = dateInfo[month][day].text;\n    if (dateInfo[month][day].link) {\n      dateInfoElement.querySelector('.date-info__link').href = dateInfo[month][day].link;\n    } else {\n      dateInfoElement.querySelector('.date-info__link').remove();\n    }\n\n    calendar.appendChild(dateInfoElement);\n  }\n}\n\nfunction renderForm(td) {\n  removeBlock();\n\n  // Берём заранее подготовленный шаблон из разметки и делаем его копию\n  let template = document.querySelector('#form-template').content.querySelector('.form');\n  let formElement = template.cloneNode(true);\n\n  let month = td.offsetParent.caption.textContent;\n  let day = td.textContent;\n\n  // Избавляемся от звёздочки, заменяем окончание у месяцев\n  day = (/\\*/i.test(day)) ? day.slice(0, day.length-1) : day;\n  month = month.replace(/[а-я]$/, (match) => {\n    return (match === 'т') ? 'та' : 'я';\n  });\n\n  // Заполняяем день и месяц\n  formElement.querySelector('.form__label').textContent = `${day} ${month}`;\n\n  // Добавляем форму на страницу\n  calendar.appendChild(formElement);\n\n  let form = document.querySelector(\"form\");\n  form.addEventListener(\"submit\", fillForm);\n\n  function fillForm(event) {\n    event.preventDefault();\n\n    let month = td.offsetParent.caption.dataset.month;\n    let day = `day${form.querySelector('.form__label').textContent.replace(/\\D/g, '')}`;\n\n    dateInfo[month][day] = {\n      date: form.querySelector('.form__label').textContent,\n      text: form.textarea.value,\n    };\n\n    form.remove();\n    renderCalendar();\n    form.removeEventListener(\"submit\", fillForm);\n  }\n}\n\nfunction removeBlock() {\n  // Если уже существует блок с формой на странице, то удаляем его\n  if (calendar.querySelector('.form')) {\n    calendar.querySelector('.form').remove();\n  }\n\n  // Если уже существует блок с информацией на странице, то удаляем его\n  if (calendar.querySelector('.date-info')) {\n    calendar.querySelector('.date-info').remove();\n  }\n}\n\nfunction renderCalendar() {\n  for (let month in dateInfo) {\n    for (let day in dateInfo[month]) {\n      day = day.replace(/\\D/g, '');\n\n      let all = calendar.querySelectorAll('.table td');\n      all.forEach(item => {\n        let holiday = (/\\*/i.test(item.textContent)) ? item.textContent.slice(0, item.textContent.length-1) : item.textContent;\n        if (holiday == day && item.offsetParent.caption.dataset.month == month) {\n          item.classList.add(\"table__day--active\");\n        }\n      })\n    }\n  }\n}\n\nrenderCalendar();\n\n\nsaveButton.addEventListener(\"click\", (event) => {\n  event.preventDefault();\n  renderDates();\n  location.href = 'dates.html';\n});\n\nfunction renderDates() {\n  let fragment = document.createDocumentFragment();\n  let activeDates = calendar.querySelectorAll('.table__day--active');\n\n\n  activeDates.forEach(item => {\n    // Берём заранее подготовленный шаблон из разметки и делаем его копию\n    let template = document.querySelector('#date-info-template').content.querySelector('.date-info');\n    let dateInfoElement = template.cloneNode(true);\n    dateInfoElement.classList.remove('calendar__info');\n    dateInfoElement.classList.add('dates__item');\n\n\n    // Записываем в переменные месяц и день из ячейки таблицы, по которой произошел клик\n    let month = `${item.offsetParent.caption.dataset.month}`;\n    let day = `day${(/\\*/i.test(item.textContent)) ? item.textContent.slice(0, item.textContent.length-1) : item.textContent}`;\n\n    // Создаём 1 экземпляр и заполняем его\n    if (dateInfo[month][day]) {\n      dateInfoElement.querySelector('.date-info__title').textContent = dateInfo[month][day].date;\n      dateInfoElement.querySelector('.date-info__text').textContent = dateInfo[month][day].text;\n      dateInfoElement.querySelector('.date-info__link').remove();\n\n      fragment.appendChild(dateInfoElement);\n    }\n  });\n\n  let div = document.createElement('div');\n  div.appendChild(fragment);\n  let selectedText = div.innerHTML;\n  localStorage.fragment = JSON.stringify(selectedText);\n}\n"]}